<template>
  <div class="post">
    <div class="band"></div>
    <div class="post-summary">
      <div class="post-thumbnail progressive full" v-if="!remote">
        <gmap-map
          v-if="post.custom_fields.venue"
          :center="{ lat: parseFloat(post.custom_fields.venue.lat), lng: parseFloat(post.custom_fields.venue.lng) }"
          :zoom="16"
          :options="mapOptions"
          class="post-map">
          <GmapMarker :position="{ lat: parseFloat(post.custom_fields.venue.lat), lng: parseFloat(post.custom_fields.venue.lng) }" />
        </gmap-map>
      </div>
      <div v-else>
        <div class="post-thumbnail progressive full" v-if="post.hasOwnProperty('featured_image_src') && post.featured_image_src['full'][0]">
          <img class="lazy" v-progressive="post.featured_image_src['full'][0]" :data-srcset="post.featured_image_src['srcset']" :src="post.featured_image_src['full'][0]" />
        </div>
      </div>
      <div class="post-summary-content">
        <h2 class="post-title"><router-link :to="{ name: (!remote) ? 'event' : 'article', params: { name: post.slug, remote }}"><span v-html="post.title.rendered"></span></router-link> </h2>
        <div class="post-meta" v-if="remote">
          <span class="posted-on">
            <span class="date" v-text="formatDate(post.date)">
            </span>
          </span>
        </div>

        <div class="post-fields" v-if="!remote">
          <ul>
            <li><i class="fal fa-calendar-alt fa-fw"></i> <span v-text="formatDate(post.custom_fields.date)"></span> a les {{ post.custom_fields.time }}</li>
            <li><i class="fal fa-map-marker-alt fa-fw"></i> {{ post.custom_fields.venue_text }}</li>
          </ul>
        </div>

        <div class="post-excerpt post-content" v-html="post.excerpt.rendered" v-if="remote"></div>

        <div class="post-read-more">
          <router-link :to="{ name: (!remote) ? 'event' : 'article', params: { name: post.slug, remote }}">+ Més info</router-link>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
const mapStyle = require('../maps/events-mapstyle.json')

export default {
  name: 'post-summary',
  props: {
    post: Object,
    remote: Boolean
  },
  data () {
    return {
      mapOptions: {
        styles: mapStyle,
        streetViewControl: false,
        mapTypeControl: false,
        fullscreenControl: false,
        scrollwheel: false,
        disableDefaultUI: true,
        draggable: false
      }
    }
  },
  methods: {
    formatDate (value) {
      if (value) {
        const date = new Date(value)
        const monthNames = ['gener', 'febrer', 'març',
          'abril', 'maig', 'juny', 'juliol',
          'agost', 'setembre', 'octubre',
          'novembre', 'desembre']
        const monthStartingWithVowels = [3, 7, 9]

        const day = date.getDate()
        const monthIndex = date.getMonth()
        const year = date.getFullYear()
        const prep = (monthStartingWithVowels.includes(monthIndex)) ? 'd\' ' : 'de '

        return day + ' ' + prep + monthNames[monthIndex] + ' de ' + year
      }
    }
  }
}
</script>
